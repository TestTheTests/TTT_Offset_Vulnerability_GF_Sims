require(ggplot2)
require(dplyr)
require(grid)
require(gridExtra)
require(gtools)
require(cowplot)
require(stringr)
require(reshape2)
require(qqman)
require(OutFLANK)
require(vcfR)
require(adegenet)
require(gdm)
require(gradientForest)
require(foreach)
require(doParallel)
require(OutFLANK)
require(pbapply)
require(gdata)
require(data.table)
require(PresenceAbsence)
require(ROCR)
require(modEvA)
require(ggplot2)
require(dplyr)
require(grid)
require(gridExtra)
require(gtools)
require(cowplot)
require(stringr)
require(reshape2)
require(qqman)
install.packages("devtools")
require(devtools)
require(qvalue)
install.packages("qvalue")
devtools::install_github("whitlock/OutFLANK")
install.packages("BiocManager")
BiocManager::install("qvalue")
require(qvalue)
devtools::install_github("whitlock/OutFLANK")
require(OutFLANK)
require(vcfR)
require(adegenet)
require(gdm)
require(gradientForest)
require(foreach)
require(doParallel)
require(OutFLANK)
require(pbapply)
require(gdata)
require(data.table)
require(PresenceAbsence)
require(ROCR)
require(modEvA)
require(ggplot2)
require(dplyr)
require(grid)
require(gridExtra)
require(gtools)
require(cowplot)
require(stringr)
require(reshape2)
require(qqman)
install.packages("gradientForest", repos = c("http://R-Forge.R-project.org"), dep = TRUE)
install.packages("extendedForest", repos = c("http://R-Forge.R-project.org"), dep = TRUE)
install.packages("extendedForest", repos="http://R-Forge.R-project.org")
install.packages("conformal", repos="http://R-Forge.R-project.org")
install.packages("extendedForest", repos = c("http://R-Forge.R-project.org"), dep = TRUE)
install.packages("gradientForest", repos = c("http://R-Forge.R-project.org"), dep = TRUE)
install.packages("gradientForest", repos="http://R-Forge.R-project.org")
options(repos='http://cran.rstudio.com/')
install.packages("gradientForest", repos="http://R-Forge.R-project.org")
install.packages("gradientForest", repos="http://R-Forge.R-project.org", type="source")
install.packages("extendedForest", repos="http://R-Forge.R-project.org", type="source")
install.packages("extendedForest", repos="http://R-Forge.R-project.org", type="source")
install.packages("conformal", repos="http://R-Forge.R-project.org", type="source")
install.packages("extendedForest", repos="http://R-Forge.R-project.org", type="source")
install.packages("gradientForest", repos="http://R-Forge.R-project.org", type="source")
require(devtools)
install.packages("extendedForest", repos="http://R-Forge.R-project.org", type="source")
install.packages("gradientForest", repos="http://R-Forge.R-project.org", dependencies = T, type="source")
list.file()
list.files()
exit
quit()
library(learnPopGen)
install.packages("learnPopGen")
library(learnPopGen)
coalescent.plot(n=10,ngen= 10,col.order="alternating")
require(brms)
zinb <- read.csv("http://stats.idre.ucla.edu/stat/data/fish.csv")
zinb$camper <- factor(zinb$camper, labels = c("no", "yes"))
head(zinb)
fit_zinb1 <- brm(count ~ persons + child + camper, data = zinb,
family = zero_inflated_poisson("log"))
summary(fit_zinb1)
require(brms)
zinb <- read.csv("http://stats.idre.ucla.edu/stat/data/fish.csv")
zinb$camper <- factor(zinb$camper, labels = c("no", "yes"))
head(zinb)
fit_zinb1 <- brm(count ~ persons + child + camper, data = zinb,
family = zero_inflated_poisson("log"))
summary(fit_zinb1)
#Example 2
data("rent99", package = "gamlss.data")
install.packages("gamlss.data")
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 2, cores = 2)
#Example 2
data("rent99", package = "gamlss.data")
head(rent99)
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 2, cores = 2)
rstan:::get_CXX()
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 4, cores = 2)
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
devtools::install_github("stan-dev/rstan", ref = "develop", subdir =
"rstan/rstan")
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
install.packages("rstanarm", type = "source")
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
install.packages("StanHeaders")
install.packages("StanHeaders")
install.packages("StanHeaders")
install.packages("StanHeaders")
install.packages(c("bayesplot", "bigreadr", "BiocManager", "calibrate", "caTools", "classInt", "covr", "curl", "data.table", "DT", "e1071", "fields", "foghorn", "future", "gdtools", "gstat", "haven", "hexbin", "highlight", "hms", "htmltools", "htmlwidgets", "httpuv", "igraph", "jomo", "jpeg", "KernSmooth", "knitr", "later", "leaflet", "magick", "maptools", "Matrix", "mgcv", "nlme", "pbapply", "pingr", "promises", "purrr", "quadprog", "R.oo", "raster", "RcppArmadillo", "rgdal", "rgeos", "RgoogleMaps", "rmarkdown", "roxygen2", "rrcov", "RSpectra", "rvest", "selectr", "seqinr", "sf", "shiny", "sp", "spam", "spData", "spdep", "stringdist", "survival", "sys", "testthat", "tidyr", "tidyverse", "tinytex", "tmap", "units", "vegan", "webshot", "whisker", "xfun"))
require(StanHeaders)
require(brms)
require(rstan)
require(StanHeaders)
#Example 2
data("rent99", package = "gamlss.data")
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
rstan_options(auto_write = TRUE)
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99,
chains = 1, cores = 2)
#Example 1
zinb <- read.csv("http://stats.idre.ucla.edu/stat/data/fish.csv")
zinb$camper <- factor(zinb$camper, labels = c("no", "yes"))
head(zinb)
fit_zinb1 <- brm(count ~ persons + child + camper, data = zinb,
family = zero_inflated_poisson("log"))
marginal_effects(fit_zinb1)
fit_zinb2 <- brm(bf(count ~ persons + child + camper, zi ~ child),
data = zinb, family = zero_inflated_poisson())
summary(fit_zinb2)
loo(fit_zinb1, fit_zinb2)
#Example 2
data("rent99", package = "gamlss.data")
head(rent99)
fit_zinb2 <- brm(bf(count ~ persons + child + camper, zi ~ child),
data = zinb, family = zero_inflated_poisson())
summary(fit_rent1)
fit_rent1 <- brm(rentsqm ~ t2(area, yearc) + (1|district), data = rent99)
marginal_effects(fit_rent1, surface = TRUE)
bform <- bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district))
fit_rent2 <- brm(bform, data = rent99)#, chains = 2, cores = 2)
require(brms)
require(rstan)
require(StanHeaders)
fit_rent2 <- brm(bform, data = rent99, chains = 2)#, cores = 2)
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
bform <- bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district))
fit_rent2 <- brm(bform, data = rent99, chains = 2)#, cores = 2)
rstan:::get_CXX()
pkgbuild::has_build_tools(debug = TRUE)
dotR <- file.path(Sys.getenv("HOME"), ".R")
if (!file.exists(dotR)) dir.create(dotR)
M <- file.path(dotR, ifelse(.Platform$OS.type == "windows", "Makevars.win", "Makevars"))
if (!file.exists(M)) file.create(M)
cat("\nCXX14FLAGS=-O3 -march=native -mtune=native",
if( grepl("^darwin", R.version$os)) "CXX14FLAGS += -arch x86_64 -ftemplate-depth-256" else
if (.Platform$OS.type == "windows") "CXX11FLAGS=-O3 -march=corei7 -mtune=corei7" else
"CXX14FLAGS += -fPIC",
file = M, sep = "\n", append = TRUE)
library("rstan")
require(brms)
bform <- bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district))
fit_rent2 <- brm(bform, data = rent99, chains = 2)#, cores = 2)
install.packages(c('Rcpp', 'RcppArmadillo'))
install.packages(c("Rcpp", "RcppArmadillo"))
install.packages(c("Rcpp", "RcppArmadillo"))
install.packages(c('Rcpp', 'RcppArmadillo'))
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
head(rent99)
bform <- bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district))
fit_rent2 <- brm(bform, data = rent99, chains = 2)#, cores = 2)
require(brms)
require(Rcpp)
require(RcppArmadillo)
require(rstan)
require(StanHeaders)
rstan_options(auto_write = TRUE)
bform <- bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district))
fit_rent2 <- brm(bform, data = rent99, chains = 2)#, cores = 2)
fit_rent2 <- brm(bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district)), data = rent99, chains = 2)#, cores = 2)
fit_rent2 <- brm(bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district)), data = rent99)#, chains = 2, cores = 2)
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
fit_rent2 <- brm(bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district)), data = rent99, chains = 2)#, cores = 2)
require(brms)
#Example 2
data("rent99", package = "gamlss.data")
head(rent99)
fit_rent2 <- brm(bf(rentsqm ~ t2(area, yearc) + (1|ID1|district),sigma ~ t2(area, yearc) + (1|ID1|district)), data = rent99, chains = 2)#, cores = 2)
rm(list=ls())
# for now don't worry about the math,
# just look at the plot after the function
get_fitness_from_env_m2 <- function(env, s){
fitness <- c()
fitness[env<5] <-  1 + s*env[env<5]
fitness[env>=5] <- 1 + s*5 + -4*s*(env[env>=5]-5)
return(fitness)
}
# In this case I am considering a type of thermal performance curve
# approximated with two linear functions
env <- -5:8
plot(env, get_fitness_from_env_m2(env, 0.1),
type="l", col=colfunc(10), lwd=2,
xlab="Environment", ylab="Fitness conferred by mutation")
abline(h=1)
?colorRampPalette
colfunc<-colorRampPalette(c("orange","cyan"))
env <- -5:8
plot(env, get_fitness_from_env_m2(env, 0.1),
type="l", col=colfunc(10), lwd=2,
xlab="Environment", ylab="Fitness conferred by mutation")
abline(h=1)
env_fit<-data.frame(env, get_fitness_from_env_m2(env, 0.1))
env_fit$Col <- c(1:10,20,20,20,20)
ggplot(data=env_fit,aes(x = env_fit$env, y = env_fit$get_fitness_from_env_m2.env..0.1., colour=env_fit$Col)) +
geom_line(size = 2)  +
scale_colour_gradient2(low="orange", mid="cyan",high="red",midpoint =10,guide=F)+
theme(legend.position="none")+
xlab("Environment")+
scale_x_discrete(limits=c(seq(-4,8.5,2)))+
ylab("Relative Fitness conferred by mutation")+
#coord_cartesian(xlim=c(-4,8),ylim=c(0.4,1.5),expand = T)+
#ylim(0.2,1.6)+
scale_y_continuous(breaks = c(.4,.6,.8,1,1.2,1.4), limits=c(0.3,1.5))+
theme_bw(base_size = 16)+
theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),)+
theme(axis.title.y = element_text(size=14))
require(ggplot2)
env_fit<-data.frame(env, get_fitness_from_env_m2(env, 0.1))
env_fit$Col <- c(1:10,20,20,20,20)
ggplot(data=env_fit,aes(x = env_fit$env, y = env_fit$get_fitness_from_env_m2.env..0.1., colour=env_fit$Col)) +
geom_line(size = 2)  +
scale_colour_gradient2(low="orange", mid="cyan",high="red",midpoint =10,guide=F)+
theme(legend.position="none")+
xlab("Environment")+
scale_x_discrete(limits=c(seq(-4,8.5,2)))+
ylab("Relative Fitness conferred by mutation")+
#coord_cartesian(xlim=c(-4,8),ylim=c(0.4,1.5),expand = T)+
#ylim(0.2,1.6)+
scale_y_continuous(breaks = c(.4,.6,.8,1,1.2,1.4), limits=c(0.3,1.5))+
theme_bw(base_size = 16)+
theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),)+
theme(axis.title.y = element_text(size=14))
ggplot(data=env_fit,aes(x = env_fit$env, y = 1, colour=env_fit$Col)) +
geom_line(size = 2)  +
scale_colour_gradient2(low="orange", mid="cyan",high="red",midpoint =10,guide=F)+
theme(legend.position="none")+
xlab("Environment")+
scale_x_discrete(limits=c(seq(-4,8.5,2)))+
ylab("Relative Fitness conferred by mutation")+
#coord_cartesian(xlim=c(-4,8),ylim=c(0.4,1.5),expand = T)+
#ylim(0.2,1.6)+
scale_y_continuous(breaks = c(.4,.6,.8,1,1.2,1.4), limits=c(0.3,1.5))+
theme_bw(base_size = 16)+
theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),)+
theme(axis.title.y = element_text(size=14))
load("~/Desktop/1593909929523.RData")
fs2<-rowsum(fff2[-1,-c(1:3)],fff2$names2[-1])
plot(fs2$V2, type="l",lwd=2,xlab="Optima",ylab="Mutant allele frequency",col=hsv(0.12,sum(fs2$V2)+0.5),ylim=c(0,4))
for(i in 2:ncol(fs2)){
lines(fs2[,i],lwd=2,col="green")
}
View(fs2)
View(fs2)
fs2$V2
fff2$names2[-1]
names
names2
str(fff1)
#seed = 1278335993644
#seed = 3916598271113
#seed = 4496341759106
#seed = 2519699755125
#seed = 7502828106749
seed = 5518873473655
#f1<-list.files("results/SLiM_output/Sim_sum")[grep(".txt",list.files("results/SLiM_output/Sim_sum"))][5]
#(seed<-substr(f1, start=1, stop=13))
#fit<-read.table(paste("Fit_SP_100_",seed,".txt",sep=""),fill=T)
fit<-read.table(paste("results/SLiM_output/Sim_sum/",seed,"_Freq_NL.txt",sep=""))
setwd("/Users/akijarl/Desktop/PostDoc/TTT_Offset_Vulnerability_GF_Sims/")
#f1<-list.files("results/SLiM_output/Sim_sum")[grep(".txt",list.files("results/SLiM_output/Sim_sum"))][5]
#(seed<-substr(f1, start=1, stop=13))
#fit<-read.table(paste("Fit_SP_100_",seed,".txt",sep=""),fill=T)
fit<-read.table(paste("results/SLiM_output/Sim_sum/",seed,"_Freq_NL.txt",sep=""))
fit_nam <- NULL
for(i in 1:100){
fit_nam <- c(fit_nam,paste("P",i,"_fit",sep=""))
}
freq_nam <- NULL
for(i in 1:100){
freq_nam <- c(freq_nam,paste("P",i,"_freq",sep=""))
}
env_nam <- NULL
for(i in 1:100){
env_nam <- c(env_nam,paste("P",i,"_env",sep=""))
}
colnames(fit)<-c("m","n1","n2","n3","n4","n5","n6","n7","n8","n9","n10","u","r","Env_rate","Burnin","Env_shift", "Generation", fit_nam, freq_nam, env_nam)
N<-data.frame(sum(fit$n1[1],fit$n2[1],fit$n3[1],fit$n4[1],fit$n5[1],fit$n6[1],fit$n7[1],fit$n8[1],fit$n9[1],fit$n10[1])*10)
colnames(N)<-"N"
(specs<-data.frame(seed,N,fit[1,c(1,12:16)],fit[1,c(2:11)]))
plotTitle <- paste(colnames(specs)[1],":",specs[[1]],", ", colnames(specs)[2],":",specs[2],", ",colnames(specs)[3],":",specs[3],", ",colnames(specs)[4],":",1e-7,",",colnames(specs)[5],":",specs[5],", ",colnames(specs)[6],":",specs[6],",\n ",colnames(specs)[7],":",specs[7],", ",colnames(specs)[8],":",specs[8],sep="")
gen_nam <- paste("Gen",fit$Generation,sep="")
fitt<-data.frame(t(fit[,-1:-17])) # For neutral simulation
colnames(fitt)<-gen_nam
fitt$Location <- as.factor(rep(paste("A",seq(1,10,1),sep=""),30))
fitt$Location <- factor(fitt$Location, levels = unique(fitt$Location))
fitt$Type <- as.factor(c(rep("Fit",100),rep("Freq",100),rep("Env",100)))
vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,"_filtered.recode.vcf",sep=""))
require(OutFLANK, lib.loc=library.path)
require(OutFLANK)
require(vcfR)
require(adegenet)
require(gdm)
require(gradientForest)
require(foreach)
require(doParallel)
require(pbapply)
require(gdata)
require(data.table)
require(PresenceAbsence)
require(ROCR)
require(modEvA)
require(dplyr)
require(grid)
require(gridExtra)
require(gtools)
require(stringr)
require(reshape2)
vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,"_filtered.recode.vcf",sep=""))
#vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,"_filtered_subset.recode.vcf",sep=""))
geno1_filt <- vcf1_filt@gt[,-1] # Remove 1st column, which is 'Format'
position1_filt <- as.numeric(getPOS(vcf1_filt)) # Positions in bp
chromosome1_filt <- as.numeric(getCHROM(vcf1_filt)) # Chromosome information
vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,"_filtered.recode.vcf",sep=""))
vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,"_filtered.recode.vcf",sep=""))
vcf1_filt <- read.vcfR(paste("results/SLiM_output/VCF_files/T1_",seed,".recode.vcf",sep=""))
geno1_filt <- vcf1_filt@gt[,-1] # Remove 1st column, which is 'Format'
position1_filt <- as.numeric(getPOS(vcf1_filt)) # Positions in bp
chromosome1_filt <- as.numeric(getCHROM(vcf1_filt)) # Chromosome information
No_A<-unname(dim(vcf1_filt)[1]) #Get the number of filtered alleles
rm(vcf1_filt)
G1f <- matrix(NA, nrow = nrow(geno1_filt), ncol = ncol(geno1_filt))
G1f[geno1_filt %in% c("0/0", "0|0")] <- 0
G1f[geno1_filt %in% c("0/1", "1/0", "1|0", "0|1")] <- 1
G1f[geno1_filt %in% c("1/1", "1|1")] <- 2
#Check number of duplicate positions
sum(duplicated(position1_filt))
position1_filt[duplicated(position1_filt)]
sum(duplicated(position2_filt))
specs[,9:18]
specs[,9:18]/10
as.numeric(unname(specs[,9:18]/10))
c(St,St[i]+demes[i])
#No subsample (neutral / size variation)
St=1
demes=as.numeric(unname(specs[,9:18]/10))
for(i in 1:9){
St=c(St,St[i]+demes[i])
}
St
Start<-NULL
for(i in seq(0,900,100)){
Start<-c(Start,St+i)
}
Start
specs[,9:18]
St
specs[,9:18]
unname(specs[,9:18])
unname(specs[,9:18])
as.numeric(unname(specs[,9:18]))
demes=as.numeric(unname(specs[,9:18]))
seq(0,900,100)
St=1
demes=as.numeric(unname(specs[,9:18]))
for(i in 1:9){
St=c(St,St[i]+demes[i])
}
St
Start<-NULL
for(i in seq(0,900,100)){
Start<-c(Start,St+i)
}
Start
dim(G1f)
Sp=demes[1]
for(i in 1:9){
Sp=c(Sp,Sp[i]+demes[i+1])
}
Stop<-NULL
for(i in seq(0,900,100)){
Stop<-c(Stop,Sp+i)
}
Start
Stop
cbind(Start,Stop)
diff(Start)
Start
seq(0,900,100)
seq(0,90,10)
St=10
demes=as.numeric(unname(specs[,9:18]))
for(i in 1:9){
St=c(St,St[i]+demes[i])
}
Start<-NULL
for(i in seq(0,90,10)){
Start<-c(Start,St+i)
}
Start
diff(start())
diff(Start
)
St
Start<-NULL
seq(0,90,10)
seq(0,90,10)
#No subsample (neutral / size variation)
St=1
demes=as.numeric(unname(specs[,9:18]/10))
for(i in 1:9){
St=c(St,St[i]+demes[i])
}
St=10
#No subsample (neutral / size variation)
St=1
demes=as.numeric(unname(specs[,9:18]/10))
for(i in 1:9){
St=c(St,St[i]+demes[i])
}
Start<-NULL
for(i in seq(0,900,100)){
Start<-c(Start,St+i)
}
Start
demes
demes=rep(as.numeric(unname(specs[,9:18])),100)
demes
Start<-NULL
for(i in seq(0,900,100)){
Start<-c(Start,St+i)
}
Start
demes
St
Start<-NULL
for(i in seq(0,900,100)){
Start<-c(Start,demes+i)
}
Start
i
demes+i
seq(0,900,100)
seq(0,9000,1000)
St
St=1
St
St=1
demes=rep(as.numeric(unname(specs[,9:18])),100)
for(i in demes){
St=c(St,St+demes[i])
}
rm(St)
for(i in demes){
print(demes)
#St=c(St,St+demes[i])
}
print(demes)[1]
demes
length(demes)
rep(as.numeric(unname(specs[,9:18])),100)
St=1
demes=rep(as.numeric(unname(specs[,9:18])),100)
for(i in 1:length(demes)){
St=c(St,St+demes[i])
}
rm(St)
