require(ggplot2)
require(cowplot)
require(qqman)
require(RColorBrewer)

colfunc<-colorRampPalette(c("orange","cyan"))
#All_equalC1<-gfTrans1$C.Imp_genome_before
#write.table(Scenario2_flip,"results/R_results/Scenario2_flip_CI",row.names = F,col.names = F)

Summary_Pop <- read.csv(file = "results/R_results/1278335993644_summary_Pop.csv")
Env_before <- Summary_Pop$Env_before

All_equalC1<-read.table("results/R_results/1278335993644_CI")

Neutral_1<-read.table("results/R_results/2519699755125_CI")
Neutral_2<-read.table("results/R_results/5518873473655_CI")
Neutral_3<-read.table("results/R_results/5536135188855_CI")
Neutral_4<-read.table("results/R_results/5555300357555_CI")
Neutral_5<-read.table("results/R_results/5597604322855_CI")
Neutral_6<-read.table("results/R_results/5526691746355_CI")

#seed = 1589041996747
seed =5385408036410
#seed =6842444356530
#seed =4621752902865
#seed =3809137545526


Neutral_flp_1<-read.table("results/R_results/7502828106749_CI")
Neutral_flp_2<-read.table("results/R_results/1589041996747_CI")
Neutral_flp_3<-read.table("results/R_results/5385408036410_CI")
Neutral_flp_4<-read.table("results/R_results/6842444356530_CI")


ggplot() + 
  geom_line(aes(x=Env_before, y=Neutral_1$V1, colour="a"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_2$V1, colour="a"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_3$V1, colour="a"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_4$V1, colour="a"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=All_equalC1$V1, colour="b"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_flp_1$V1, colour="c"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_flp_2$V1, colour="c"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_flp_3$V1, colour="c"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Neutral_flp_4$V1, colour="c"), lwd=1.5) +
  #facet_grid(. ~ strSel) +
  labs(y="GF Cumulative Importance", x="Environment") +
  #geom_line(data=cImpMAF.neut, aes(x=x, y=y),
  #          colour=rgb(0,0,1, 0.75), lwd=1) +
  #geom_line(data=cImpMAF.sel, aes(x=x, y=y),
  #          colour=rgb(1,0,0, 0.75), lwd=1) +
  #geom_line(data=cImpMAF, aes(x=x, y=y),
  #          colour=rgb(0,0,0, 0.75), lwd=1) +
  theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  scale_colour_manual(values=c("a"="lightblue","b"="grey","c"="orange"),labels = c("Neutral1", "All equal", "Neutral1 flipped"),name="Model")+
  #  values=c(rgb(1,0,0,0.4),rgb(0,1,0,0.4),rgb(0,0,0,0.4),rgb(0,0,1,0.4),rgb(0.4,0,0,0.4))) +
  theme(plot.title = element_text(size=14, face="bold.italic"))


#For neutral simulation
plot(fit$Gen,fit$P19_env,type="l", main=plotTitle, xlab="Generations",ylab="Environmental variable",col="white",ylim=c(-1,5))
k=1
for(i in which(fitt$Type=="Env")){
  lines(fit$Gen,fit[,i+17],lwd=2,col=colfunc(10)[k])
  k=k+1
}


plot(fit$Gen,fit$P19_fit,type="l",main=plotTitle ,xlab="Generations",ylab="Relative Fitness",col="red")
x=1:10
y=1:10
for(i in x){
  for(j in y){
    k=((i - 1) + (j - 1) * 10 + 18)
    lines(fit$Gen,fit[,k],col=colfunc(10)[i])
  }
}

plot(fit$Gen,fit$P19_freq,type="l", main=plotTitle, xlab="Generations",ylab="Mutant allele frequency",col="red",ylim=c(0,1))
x=1:10
y=1:10
for(i in x){
  for(j in y){
    k=((i - 1) + (j - 1) * 10 + 118)
    lines(fit$Gen,fit[,k],col=colfunc(10)[i])
  }
}

ggplot() + 
  geom_line(aes(x=envPop$envSelect, y=gfTrans1$C.Imp_genome_before), colour=rgb(0,0,0,0.4), lwd=1.5) +
  labs(y="GF Cumulative Importance", x="Environment") +
  theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  theme(strip.text = element_text(size=16)) +
  ggtitle(plotTitle) +
  theme(plot.title = element_text(size=14, face="bold.italic"))

#For neutral simulation, plot deme size vs GF Offset
Summary_Pop <- read.csv(file = "results/R_results/2519699755125_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/5518873473655_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/5526691746355_summary_Pop.csv")

Summary_Pop <- read.csv(file = "results/R_results/7502828106749_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/1589041996747_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/5385408036410_summary_Pop.csv")


colfunc<-colorRampPalette(c("orange","cyan"))


Neutral_1<-read.table("results/R_results/2519699755125_CI")

Summary_Pop <- read.csv(file = "results/R_results/2519699755125_summary_Pop.csv")

A <- ggplot() + 
  geom_line(aes(x=rep(1:10,10), y=Summary_Pop$C.Imp_genome_before), colour=rgb(0,0,0,0.4), lwd=1.5) +
  labs(y="GF Cumulative Importance", x="X-Location") +
  scale_x_continuous(breaks=c(1:10))+
  #theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  theme(strip.text = element_text(size=16)) +
  theme(plot.title = element_text(size=14, face="bold.italic"))

#popsum <- Summary_Pop[1:10,]
# GF_Offset <- NULL
# ref <- seq(1,9,2)
# count <- 1
# while(count<5){
#   GF_Offset <- c(GF_Offset,popsum$C.Imp_genome_before[ref[count+1]]-popsum$C.Imp_genome_before[ref[count]])
#   count=count+1
# }
popsum <- Summary_Pop[1:10,]
GF_Offset <- NULL
ref <- seq(1,10,1)
count <- 1
while(count<10){
    GF_Offset <- c(GF_Offset,popsum$C.Imp_genome_before[ref[count+1]]-popsum$C.Imp_genome_before[ref[count]])
    count=count+1
}

#comp<-c("1-3","3-5","5-7","7-9")
comp<-c("1-2","2-3","3-4","4-5","5-6","6-7","7-8","8-9","9-10")
GFoff <- data.frame(comp,GF_Offset)

B <- ggplot(data=GFoff, aes(x=comp, y=GF_Offset))+
  geom_bar(stat="identity")+
  labs(y="GF Offset", x="Comparison")+
  theme_classic() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  theme(strip.text = element_text(size=16)) +
  theme(plot.title = element_text(size=14, face="bold.italic"))
  

#barplot(GF_Offset)

plot_grid(A,B,nrow=2,align="v",rel_heights=c(2,1),rel_widths = c(1,2))


Size <- popsum$Pop_size[1:9]
#Size <- c(sum(popsum$Pop_size[1:3]),sum(popsum$Pop_size[3:5]),sum(popsum$Pop_size[5:7]),sum(popsum$Pop_size[7:9]))

Comp_size <- data.frame(Size, GF_Offset)

rho_test<-cor.test(Comp_size$GF_Offset,Comp_size$Size, method = "pearson")
ggplot(data=Comp_size,aes(x=GF_Offset,y=Size,color=Size,size=2))+
  geom_point()+
  ylab("Deme size")+
  xlab(expression(paste("GF Offset")))+
  scale_colour_gradientn(colours = colfunc(9))+
  theme_classic(base_size = 16)+
  #ylim(10,220)+
  theme(legend.position = "none")+
  geom_smooth(method='lm',col="red",size=1,se=F)+
  annotate("text", x = max(Comp_size$GF_Offset)-0.005, y = max(Comp_size$Size)-50, label = paste("r = ",round(rho_test$estimate,3), "\np-value = ",round(rho_test$p.value,7), sep=""))

#rho_test<-cor.test(Comp_size$GF_Offset,Comp_size$Size, method = "pearson" )
# B <-ggplot(data=Comp_size,aes(x=GF_Offset,y=Size,color=Size,size=2))+
#   geom_point()+
#   ylab("Deme size")+
#   xlab(expression(paste("GF Gen offset Genome")))+
#   scale_colour_gradientn(colours = colfunc(9))+
#   theme_classic(base_size = 16)+
#   #ylim(10,220)+
#   theme(legend.position = "none")+
#   geom_smooth(method='lm',col="red",size=1,se=F)+
#   annotate("text", x = max(Comp_size$GF_Offset)-0.005, y = max(Comp_size$Size)-50, label = paste("r = ",round(rho_test$estimate,3), "\np-value = ",round(rho_test$p.value,7), sep=""))
# 
# plot_grid(A,B,nrow=2)
