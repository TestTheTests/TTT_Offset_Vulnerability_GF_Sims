require(ggplot2)
require(cowplot)
require(qqman)
require(RColorBrewer)

colfunc<-colorRampPalette(c("orange","cyan"))
#All_equalC1<-gfTrans1$C.Imp_genome_before
#write.table(Scenario2_flip,"results/R_results/Scenario2_flip_CI",row.names = F,col.names = F)

All_equalC1<-read.table("results/R_results/AllEqual_CI")
Scenario1<-read.table("results/R_results/Scenario1_CI")
Scenario2<-read.table("results/R_results/Scenario2_CI")
Scenario1_flp<-read.table("results/R_results/Scenario1_flip_CI")
Scenario2_flp<-read.table("results/R_results/Scenario2_flip_CI")

All_equalC1<-read.table("results/R_results/1278335993644_CI")
Scenario2<-read.table("results/R_results/3916598271113_CI")
Scenario2_flp<-read.table("results/R_results/4496341759106_CI")

Scenario1<-read.table("results/R_results/2519699755125_CI")
Scenario1_flp<-read.table("results/R_results/7502828106749_CI")

ggplot() + 
  geom_line(aes(x=Env_before, y=Scenario1$V1, colour="a"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Scenario2$V1, colour="b"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=All_equalC1$V1, colour="c"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Scenario1_flp$V1, colour="d"), lwd=1.5) +
  geom_line(aes(x=Env_before, y=Scenario2_flp$V1, colour="e"), lwd=1.5) +
  #facet_grid(. ~ strSel) +
  labs(y="GF Cumulative Importance", x="Environment") +
  #geom_line(data=cImpMAF.neut, aes(x=x, y=y),
  #          colour=rgb(0,0,1, 0.75), lwd=1) +
  #geom_line(data=cImpMAF.sel, aes(x=x, y=y),
  #          colour=rgb(1,0,0, 0.75), lwd=1) +
  #geom_line(data=cImpMAF, aes(x=x, y=y),
  #          colour=rgb(0,0,0, 0.75), lwd=1) +
  theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  scale_colour_manual(values=c("a"="lightblue","b"="darkblue","c"="grey","d"="orange","e"="red"),labels = c("Scenario 1","Scenario 2", "All equal", "Scenario 1 flipped", "Scenario 2 flipped"),name="Model")+
  #  values=c(rgb(1,0,0,0.4),rgb(0,1,0,0.4),rgb(0,0,0,0.4),rgb(0,0,1,0.4),rgb(0.4,0,0,0.4))) +
  theme(plot.title = element_text(size=14, face="bold.italic"))


#For neutral simulation
plot(fit$Gen,fit$P19_env,type="l", main=plotTitle, xlab="Generations",ylab="Environmental variable",col="white",ylim=c(-1,5))
k=1
for(i in which(fitt$Type=="Env")){
  lines(fit$Gen,fit[,i+17],lwd=2,col=colfunc(10)[k])
  k=k+1
}


plot(fit$Gen,fit$P19_fit,type="l",main=plotTitle ,xlab="Generations",ylab="Relative Fitness",col="red")
x=1:10
y=1:10
for(i in x){
  for(j in y){
    k=((i - 1) + (j - 1) * 10 + 18)
    lines(fit$Gen,fit[,k],col=colfunc(10)[i])
  }
}

plot(fit$Gen,fit$P19_freq,type="l", main=plotTitle, xlab="Generations",ylab="Mutant allele frequency",col="red",ylim=c(0,1))
x=1:10
y=1:10
for(i in x){
  for(j in y){
    k=((i - 1) + (j - 1) * 10 + 118)
    lines(fit$Gen,fit[,k],col=colfunc(10)[i])
  }
}

ggplot() + 
  geom_line(aes(x=envPop$envSelect, y=gfTrans1$C.Imp_genome_before), colour=rgb(0,0,0,0.4), lwd=1.5) +
  labs(y="GF Cumulative Importance", x="Environment") +
  theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  theme(strip.text = element_text(size=16)) +
  ggtitle(plotTitle) +
  theme(plot.title = element_text(size=14, face="bold.italic"))

#For neutral simulation, plot deme size vs GF Offset
Summary_Pop <- read.csv(file = "results/R_results/1278335993644_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/2519699755125_summary_Pop.csv")
Summary_Pop <- read.csv(file = "results/R_results/7502828106749_summary_Pop.csv")

colfunc<-colorRampPalette(c("orange","cyan"))

ggplot() + 
  geom_line(aes(x=envPop$envSelect, y=Summary_Pop$C.Imp_genome_before), colour=rgb(0,0,0,0.4), lwd=1.5) +
  labs(y="GF Cumulative Importance", x="Environment") +
  theme(plot.margin = unit(c(1.25,1.25,1.25,1.25), "in")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 18, colour = "grey60"),
        axis.title.x = element_text(size=24)) +
  theme(axis.text.y = element_text(size = 16, colour = "grey60"),
        axis.title.y = element_text(size=24, vjust=1)) +
  theme(strip.text = element_text(size=16)) +
  ggtitle(plotTitle) +
  theme(plot.title = element_text(size=14, face="bold.italic"))

rho_test<-cor.test(Summary_Pop$D_C.Imp_genome,Summary_Pop$Pop_size, method = "spearman" )
ggplot(data=Summary_Pop,aes(x=D_C.Imp_genome,y=Pop_size,color=X,size=2))+
  geom_point()+
  ylab("Deme size")+
  xlab(expression(paste("GF Gen offset Genome")))+
  scale_colour_gradientn(colours = colfunc(10))+
  theme_classic(base_size = 16)+
  ylim(10,220)+
  theme(legend.position = "none")+
  ggtitle(plotTitle) +
  geom_smooth(method='lm',col="red",size=1,se=F)+
  annotate("text", x = max(Summary_Pop$D_C.Imp_genome)-max(Summary_Pop$D_C.Imp_genome)*0.1, y = min(Summary_Pop$Pop_size)+min(Summary_Pop$Pop_size)*1.5, label = paste("Rho = ",round(rho_test$estimate,3), "\np-value = ",round(rho_test$p.value,22), sep=""))
