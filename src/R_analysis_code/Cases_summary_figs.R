require(grid)
require(RColorBrewer)
require(ggplot2)

setwd("E:/Research_AJL/TTT_Offset_Vulnerability_GF_Sims/")

options(scipen = 999)
seed_table <- read.table("seeds_source_R.txt")

w=11

seed=seed_table$V2[w]

fit<-read.table(paste("results/SLiM_output/Sim_sum/",seed,"_Freq_ML_WF.txt",sep=""), header=T)

N<-data.frame(fit$n[1]*100)
colnames(N)<-"N"

if(ncol(fit)==613){
  (specs<-data.frame(seed,fit[1,1:2],N,fit[1,3:12]))
  plotTitle <- paste(colnames(specs)[1],":",specs[[1]],", ", colnames(specs)[2],":",specs[2],", ",colnames(specs)[3],":",specs[3],", ",colnames(specs)[4],":",specs[4],",",colnames(specs)[5],":",specs[5],"\n",colnames(specs)[6],":",specs[6],", ",colnames(specs)[7],":",specs[7],", ",colnames(specs)[8],":",specs[8],", ",colnames(specs)[9],":",specs[9],", ",colnames(specs)[10],":",specs[10], sep="")
  fitt<-data.frame(t(fit[,-1:-13]))
} else {
  (specs<-data.frame(seed,fit[1,1:2],N,fit[1,3:13])) # for case4
  plotTitle <- paste(colnames(specs)[1],":",specs[[1]],", ", colnames(specs)[2],":",specs[2],", ",colnames(specs)[3],":",specs[3],", ",colnames(specs)[4],":",specs[4],",",colnames(specs)[5],":",specs[5],"\n",colnames(specs)[6],":",specs[6],", ",colnames(specs)[7],":",specs[7],", ",colnames(specs)[8],":",specs[8],", ",colnames(specs)[9],":",specs[9],", ",colnames(specs)[10],":",specs[10],", ",colnames(specs)[11],":",specs[11],sep="") # for case4
  fitt<-data.frame(t(fit[,-1:-14])) # for case4
}

gen_nam <- paste("Gen",fit$Generation,sep="")

colnames(fitt)<-gen_nam

fitt$Location <- factor(rep(paste("P",1:100,sep=""),6), levels = unique(rep(paste("P",1:100,sep=""),6)))

fitt$Type <- as.factor(c(rep("Fit",100),rep("Freq",100),rep("Phen1",100), rep("Phen2",100),rep("Env1",100), rep("Env2",100)))

gradient <- matrix(fitt[fitt$Type=="Env1",30],nrow=10,byrow = T)

gradient <- gradient - min(gradient)
gradient <- gradient / max(gradient)

make_gradient <- function(n = 10, cols = blues9) {
  cols <- colorRampPalette(cols)(n + 1)
  mat <- gradient
  mat <- 1 + mat * n
  mat <- matrix(data = cols[round(mat)], ncol = n)
  grid::rasterGrob(
    image = mat,
    width = unit(1, "npc"),
    height = unit(1, "npc"), 
    interpolate = TRUE
  )
}

g <- make_gradient(
  n = 10, cols = brewer.pal(9, "Blues")
)

g <- make_gradient(
  n = 10, cols = brewer.pal(9, "Oranges")
)

grid.newpage()
grid.draw(g)

gradient <- matrix(fitt[fitt$Type=="Env2",30],nrow=10,byrow = T)
gradient <- gradient - min(gradient)
gradient <- gradient / max(gradient)

g <- make_gradient(
  n = 10, cols = brewer.pal(9, "Blues")
)

grid.newpage()
grid.draw(g)

w=1

for(w in 1:nrow(seed_table)){

seed=seed_table$V2[w]

ind<-read.table(paste("results/SLiM_output/",seed,"_ind.txt",sep=""),sep = " ", header=T)

p<-ggplot(data=ind)+
  geom_smooth(aes(x=opt0, y=phen0), method="lm",se = T,color="orange",size=5)+
  geom_smooth(aes(x=opt1, y=phen1), method="lm",se = T,color="royalblue",size=5)+
  xlab("")+
  ylab("")+
  expand_limits(y=c(-1,1))+
  geom_hline(yintercept=0,size=1)+
  theme_classic()+
  theme(text=element_text(size=32))+
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())
print(p)


#for(w in 1:nrow(seed_table)){
#w=31
#seed=seed_table$V2[w]
  
cg_sum<-read.table(paste("results/SLiM_output/CG_files/",seed,"_ML_WF_CG_sum_Gen.txt",sep=""),header=T)
cg_sum[cg_sum$generation==3000,]$local_adaptation

p<-ggplot(data=cg_sum)+
  #geom_line(aes(y=sympatry, x=generation), col="green")+
  #geom_line(aes(y=allopatry, x=generation), col="orange")+
  geom_line(aes(y=corr_pheno0_opt0, x=generation), col="orange", lwd=5)+
  geom_line(aes(y=corr_pheno1_opt1, x=generation), col="royalblue", lwd=5)+
  ylim(-1,1)+
  xlim(1000,3000)+
  xlab("")+
  ylab("")+
  theme_classic()+
  theme(text=element_text(size=32))+
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())

print(p)
}

#Case 1
#Sigma_K = 1.25
#curve(dnorm(x, mean=0,sd=sqrt(1.25)),-8,8,ylim=c(0,0.35),xlab = "", xaxt='n', ylab = "", yaxt='n', bty = "n", lwd=5)

#Case 2
#Sigma_K = 1.25

#Case 3
#Sigma_K = 1.25

#Case 4
#Sigma_K_Env1 = 1.25
#Sigma_K_Env2 = 4

curve(dnorm(x, mean=0,sd=sqrt(4)),-8,8,ylim=c(0,0.35),xlab = "", xaxt='n', ylab = "", yaxt='n', bty = "n", lwd=5)


