##########################################
# Create a bicolor meta-population matrix
##########################################
require(ggplot2)
require(cowplot)

#Set working directory inside the github repository 'TTT_Offset...' folder
#setwd("TTT_Offset_Vulnerability_GF_Sims")

#Get an initial gradient of orange to cyan
colfunc<-colorRampPalette(c("orange","cyan"))

colour <- matrix(colfunc(10)) #start a matrix object to fill out
grad <- 0.9 #set a starting gradient value

#Loop through colours adjusting the green level each time
for(i in 1:9){
  colour <- cbind(colour,adjustcolor(colour[,i],green.f=grad+0.01))
}

#Plot a 10 by 10 matrix using the colour gradient we've created
ggplot()+
  geom_point(aes(x=rep(1:10,each=10),y=rep(1:10,10)),colour=c(colour), size=10)+
  theme_classic()+
  theme_void()

##########################################
# Create a bicolor meta-population matrix
##########################################

##seed values from sims     
#seed = 5003617403563 #ML cline
#seed = 1594110774619 #ML mountain
#seed = 4438659167382 #Case 3
seed = 6698486070847 #Case4

#Read in summary file for simulation specs.
fit<-read.table(paste("results/SLiM_output/Sim_sum/",seed,"_Freq_ML_WF.txt",sep=""), header=T)

N<-data.frame(fit$n[1]*100) #total metapop size for equal deme size sims
colnames(N)<-"N" #name for specs file
(specs<-data.frame(seed,fit[1,1:2],N,fit[1,3:12])) #create a specs object for plot title

#Plot title has an extra spot at end so that var_Opt2 can be included when Case 4 results are run
plotTitle <- paste(colnames(specs)[1],":",specs[[1]],", ", colnames(specs)[2],":",specs[2],", ",colnames(specs)[3],":",specs[3],", ",colnames(specs)[4],":",specs[4],",",colnames(specs)[5],":",specs[5],"\n",colnames(specs)[6],":",specs[6],", ",colnames(specs)[7],":",specs[7],", ",colnames(specs)[8],":",specs[8],", ",colnames(specs)[9],":",specs[9],", ",colnames(specs)[10],":",specs[10],sep="")

#Read in individual phenotypes, optima, and fitness from simulations
ind<-read.table(paste("results/SLiM_output/",seed,"_ind.txt",sep=""),sep = " ", header=T)

#Set Env1 and Env2 colors
env1_col <- "orange"
env2_col <- "cyan"

#Save Env 1 plot
A <- ggplot(data=ind)+
  geom_point(aes(x=opt0, y=phen0),col=env1_col)+
  geom_smooth(aes(x=opt0, y=phen0), method="lm",se = T)+
  xlab("Environment 1")+
  ylab("Phenotype 1")+
  ylim(-3,3)+
  xlim(-1,1)+
  theme_classic()

#Save Env 2 plot
B <- ggplot(data=ind)+
  geom_point(aes(x=opt1, y=phen1),col=env2_col)+
  geom_smooth(aes(x=opt1, y=phen1), method="lm",se = T)+
  xlab("Environment 2")+
  ylab("Phenotype 2")+
  ylim(-3,3)+
  xlim(-1,1)+
  theme_classic()

#Create title
title<- ggdraw() + draw_label(plotTitle, fontface='bold')

#Plot Env1 and Env2 side-by-side
plot_grid(title,NULL,A,B,nrow=2,ncol=2,rel_heights = c(1,3))

#Total correlation 
cor(ind$phen0,ind$opt0)
cor(ind$phen1,ind$opt1)
#Total variance
var(ind$phen0)
var(ind$phen1)

#Per env1 value variance
for(i in unique(ind$opt0)){
  print(var(ind[ind$opt0==i,]$phen0))
}

#Per env2 value variance
for(i in unique(ind$opt1)){
  print(var(ind[ind$opt1==i,]$phen1))
}

#Standardized environments
ind_stan <- ind #save copy of original dataset to modify

#standardize each x in env by (x-mean(x))/sd(x)
ind_stan$opt0 <- (ind_stan$opt0-mean(ind_stan$opt0))/sd(ind_stan$opt0)
ind_stan$opt1 <- (ind_stan$opt1-mean(ind_stan$opt1))/sd(ind_stan$opt1)

#Save std. Env 1 plot
As <- ggplot(data=ind_stan)+
  geom_point(aes(x=opt0, y=phen0),col=env1_col)+
  geom_smooth(aes(x=opt0, y=phen0), method="lm",se = T)+
  xlab("Environment 1 (Std.)")+
  ylab("Phenotype 1")+
  ylim(-3,3)+
  theme_classic()

#Save std. Env 2 plot
Bs <- ggplot(data=ind_stan)+
  geom_point(aes(x=opt1, y=phen1),col=env2_col)+
  geom_smooth(aes(x=opt1, y=phen1), method="lm",se = T)+
  xlab("Environment 2 (Std.)")+
  ylab("Phenotype 2")+
  ylim(-3,3)+
  theme_classic()

#Create title
title<- ggdraw() + draw_label(plotTitle, fontface='bold')
#Plot std. Env1 and Env2 side-by-side
plot_grid(title,NULL,As,Bs,nrow=2,ncol=2,rel_heights = c(1,3))

#Total correlation
cor(ind_stan$phen0,ind_stan$opt0)
cor(ind_stan$phen1,ind_stan$opt1)
#Total variance
var(ind_stan$phen0)
var(ind_stan$phen1)

#Per std. env1 value variance
for(i in unique(ind_stan$opt0)){
  print(var(ind_stan[ind_stan$opt0==i,]$phen0))
}

#Per std. env2 value variance
for(i in unique(ind_stan$opt1)){
  print(var(ind_stan[ind_stan$opt1==i,]$phen1))
}

