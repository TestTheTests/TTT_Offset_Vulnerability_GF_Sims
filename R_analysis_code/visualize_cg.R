setwd("/Users/akijarl/Desktop/PostDoc/TTT_Offset_Vulnerability_GF_Sims/SLiM_output/CG_files/")

require(ggplot2)
require(reshape2)
require(RColorBrewer)

#load("T2_m0.05.RData")

colfunc<-colorRampPalette(c("orange","cyan"))

cg<-read.table("CG_Neut_100_1902845683137_Gen600.txt",header=F)

#cg<-read.table("CG_SP_100_1581160262936_Gen600.txt",header=F)
#cg<-data.frame(t(read.table("CG_SP_100_1581160262936_Gen300.txt",header=F)))

colnames(cg)<-paste("D",seq(1:100),sep="")
cg$Transplant<-rep(paste("T",seq(1:10),sep=""),10)

# gfcg<-rep(paste("T",seq(1:10),sep=""),10)
# for(i in envPop$envSelect){
#   envPop_t<-data.frame((rep(i,100)))
#   colnames(envPop_t)<-"envSelect"
#   gfcg <- cbind(gfcg,predict(gfMod, envPop_t))
# }

#cg$D_CI<-offset$D_C.Imp_genome

cg_df <- melt(cg,  id.vars ="Transplant",  variable.name = "Genotype", 
              value.name = "Fitness")

cg_df$Transplant<-factor(cg_df$Transplant,levels=cg_df$Transplant[1:10])

CI_bf <- gfTrans1$C.Imp_genome_before[1:10]

CI<-NULL
for(i in 1:length(CI_bf)){
  for(j in 1:length(CI_bf)){
    CI<-c(CI,CI_bf[j]-CI_bf[i])
  }
}

CI_rep<-NULL
for (i in seq(1,100,10)){
  CI_rep<-c(CI_rep,rep(CI[i:(i+9)],10))
}

CIm_bf <- gfM2Trans1$C.Imp_M2_before[1:10]

CIm<-NULL
for(i in 1:length(CIm_bf)){
  for(j in 1:length(CIm_bf)){
    CIm<-c(CIm,CIm_bf[j]-CIm_bf[i])
  }
}

CIm_rep<-NULL
for (i in seq(1,100,10)){
  CIm_rep<-c(CIm_rep,rep(CIm[i:(i+9)],10))
}

Home<-NULL
for(i in 1:10){
  Home<-c(Home,rep(paste("H",i,sep=""),100))
}
cg_df$Home <- rep(Home,10)
cg_df$Home<-factor(cg_df$Home,levels=unique(cg_df$Home))

cg_df$D_CI<-CI_rep
cg_df$D_CIm<-CIm_rep


# ggplot(data=cg_df,aes(x=cg_df$Fitness, y=cg_df$D_CI, colour=cg_df$Transplant))+
#   geom_line()+
#   geom_point(aes(shape=cg_df$Home), size=3)+
#   labs(shape="Genotype", colour="Common\nGarden\nLocation")+
#   scale_color_manual(values = colfunc(10))+
#   scale_shape_manual(values=c(15,18,16,17,19,20,21,22,23,25))+
#   xlab("Relative Fitness at end of burnin")+
#   ylab("GF Offset")

ggplot(data=cg_df,aes(x=cg_df$Fitness, y=abs(cg_df$D_CI), colour=cg_df$Transplant))+
  geom_smooth(aes(x=cg_df$Fitness, y=abs(cg_df$D_CI)),method="lm",se = F)+
  geom_point(aes(shape=cg_df$Home), size=3)+
  labs(shape="Genotype", colour="Common\nGarden\nLocation")+
  scale_color_manual(values = colfunc(10))+
  scale_shape_manual(values=c(15,18,16,17,19,20,21,22,23,25))+
  xlab("Relative Fitness in common garden")+
  ylab("Absolute GF Offset (genome)")+
  coord_flip()+
  theme_classic()+
  theme(axis.text=element_text(size=12),axis.title=element_text(size=14))

ggplot(data=cg_df,aes(x=cg_df$Fitness, y=abs(cg_df$D_CIm), colour=cg_df$Transplant))+
  geom_smooth(aes(x=cg_df$Fitness, y=abs(cg_df$D_CIm)),method="lm",se = F)+
  geom_point(aes(shape=cg_df$Home), size=3)+
  labs(shape="Genotype", colour="Common\nGarden\nLocation")+
  scale_color_manual(values = colfunc(10))+
  scale_shape_manual(values=c(15,18,16,17,19,20,21,22,23,25))+
  xlab("Relative Fitness in common garden")+
  ylab("Absolute GF Offset (allele)")+
  coord_flip()+
  theme_classic()+
  theme(axis.text=element_text(size=12),axis.title=element_text(size=14))

dat_filt<-cg_df[cg_df$Transplant==c("T1","T5","T10"),]

#dat_filt$Transplant<-factor(dat_filt$Transplant,levels=unique(dat_filt$Transplant))
#dat_filt$Home<-factor(dat_filt$Home,levels=unique(dat_filt$Home))

dat_filt$D_CI<-abs(dat_filt$D_CI)
dat_filt[]
ggplot(data=dat_filt,aes(colour=Transplant))+
  geom_smooth(aes(x=Fitness, y=D_CI), method="lm",se = F)+
  geom_point(aes(x=Fitness, y=D_CI,shape=Home), size=3)+
  labs(shape="Genotype", colour="Common\nGarden\nLocation")+
  scale_color_manual(values = colfunc(3))+
  scale_shape_manual(values=c(15,18,16,17,19,20,21,22,23,25))+
  xlab("Relative Fitness in common garden")+
  ylab("Absolute GF Offset (genome)")+
  coord_flip()+
  theme_classic()+
  theme(axis.text=element_text(size=12),axis.title=element_text(size=14))

ggplot(data=dat_filt,aes(x=Fitness, y=abs(D_CIm), colour=Transplant))+
  geom_smooth(method="lm",se = F)+
  geom_point(aes(shape=Home), size=3)+
  labs(shape="Genotype", colour="Common\nGarden\nLocation")+
  scale_color_manual(values = colfunc(3))+
  scale_shape_manual(values=c(15,18,16,17,19,20,21,22,23,25))+
  xlab("Relative Fitness in common garden")+
  ylab("Absolute GF Offset (allele)")+
  coord_flip()+
  theme_classic()+
  theme(axis.text=element_text(size=12),axis.title=element_text(size=14))

